[tox]
envlist = ${envlist}

[testenv]
allowlist_externals = ./run_tests.py
pip_pre = True
passenv =
    CFLAGS
    CPPFLAGS
    LDFLAGS
setenv =
    PYTHONPATH = {toxinidir}
deps =
    -rrequirements.txt
    -rtest_requirements.txt
    coverage: coverage
commands =
    py3{7,8,9,10,11}: ./run_tests.py
    coverage: coverage erase
    coverage: coverage run --source=${python_module_name} --omit="*_test*,*__init__*,*test_lib*" run_tests.py
    coverage: coverage xml

[testenv:codecov]
skip_install = True
allowlist_externals =
    ./codecov
passenv =
    CFLAGS
    CPPFLAGS
    GITHUB_ACTION
    GITHUB_HEAD_REF
    GITHUB_REF
    GITHUB_REPOSITORY
    GITHUB_RUN_ID
    GITHUB_SHA
    LDFLAGS
commands =
    ./codecov
